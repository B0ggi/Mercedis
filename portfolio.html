<!DOCTYPE html>
<html lang="fo">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ellinor Mercedis - Listaverk</title>
    
    <!-- Performance optimizations -->
    <link rel="preload" href="assets/css/portfolio.css" as="style">
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300italic,600italic,300,600">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css">
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="assets/css/navigation.css" />
    <link rel="stylesheet" href="assets/css/custom.css" />
    <link rel="stylesheet" href="assets/css/portfolio.css" />
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body class="page-layout">
    <!-- Navigation will be inserted here by navigation.js -->
    <nav id="navigation-placeholder"></nav>

    <main class="main-content">
        <header class="container">
            <div class="page-header">
                <h1>Listaverk</h1>
            </div>

            <!-- Desktop filter buttons -->
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">Øll listaverk</button>
                <button class="filter-btn" data-filter="available">Tøk listaverk</button>
                <button class="filter-btn" data-filter="y2025">2025</button>
                <button class="filter-btn" data-filter="y2024">2024</button>
                <button class="filter-btn" data-filter="eldri">2023 og seinni</button>
            </div>

            <!-- Mobile filter dropdown -->
            <div class="filter-dropdown-mobile">
                <label for="mobile-filter" class="sr-only">Vel bólk:</label>
                <select id="mobile-filter" class="mobile-filter-select">
                    <option value="all" selected>Øll listaverk</option>
                    <option value="available">Tøk listaverk</option>
                    <option value="y2025">2025</option>
                    <option value="y2024">2024</option>
                    <option value="eldri">Eldri listaverk</option>
                </select>
            </div>
        </header>
        
        <div class="portfolio-grid" id="portfolio-grid">
          <!-- Artworks will be inserted here by JavaScript -->
        </div>
    </main>

    <script type="module">
        // Import the enhanced artwork loader
        import { loadArtworks } from './assets/js/artwork.js';

        // Helper function to load all artworks from all collections
        async function loadAllArtworks() {
            try {
                const configUrl = 'data/config.json';
                const configResponse = await fetch(configUrl);
                const config = await configResponse.json();
                
                // Get all collection IDs (including featured)
                const allCollections = config.collections.map(c => c.id);
                
                // Load each collection and combine results
                const allArtworks = [];
                for (const collectionId of allCollections) {
                    const artworks = await loadArtworks(collectionId);
                    allArtworks.push(...artworks);
                }
                
                // Deduplicate by ID (in case same artwork is in multiple collections)
                const seen = new Set();
                return allArtworks.filter(artwork => {
                    if (seen.has(artwork.id)) return false;
                    seen.add(artwork.id);
                    return true;
                });
            } catch (error) {
                console.error('Error loading artworks:', error);
                return [];
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            const portfolioGrid = document.getElementById('portfolio-grid');
            const filterButtons = document.querySelectorAll('.filter-btn');

            // Load all artworks from all collections (including featured)
            const artworks = await loadAllArtworks();

            function createArtworkElement(art) {
                const item = document.createElement('div');
                item.className = 'portfolio-item';

                // Create elements safely without innerHTML
                const link = document.createElement('a');
                link.href = art.image;
                link.setAttribute('data-gallery', 'portfolio-gallery');
                link.title = art.title;

                const img = document.createElement('img');
                img.src = art.image;
                img.alt = art.title;
                img.loading = 'lazy';
                img.addEventListener('error', function() {
                    this.src = 'images/placeholder.jpg';
                });

                const overlay = document.createElement('div');
                overlay.className = 'artwork-overlay';

                const artworkInfo = document.createElement('div');
                artworkInfo.className = 'artwork-info';

                const title = document.createElement('h3');
                title.textContent = art.title;

                const meta = document.createElement('div');
                meta.className = 'artwork-meta';

                const year = document.createElement('span');
                year.textContent = art.year;
                meta.appendChild(year);

                if (art.technique) {
                    const technique = document.createElement('span');
                    technique.textContent = art.technique;
                    meta.appendChild(technique);
                }

                if (art.size) {
                    const size = document.createElement('span');
                    size.textContent = art.size;
                    meta.appendChild(size);
                }

                const availability = document.createElement('span');
                availability.className = `availability ${art.available ? 'available' : 'not-available'}`;
                availability.textContent = art.available ? 'Tøkt' : 'Ikki tøkt';
                meta.appendChild(availability);

                artworkInfo.appendChild(title);
                artworkInfo.appendChild(meta);
                overlay.appendChild(artworkInfo);
                link.appendChild(img);
                link.appendChild(overlay);
                item.appendChild(link);

                return item;
            }

            function renderArtworks(filter = 'all') {
                portfolioGrid.innerHTML = '';

                if (!artworks || artworks.length === 0) {
                    const message = document.createElement('p');
                    message.style.cssText = 'grid-column: 1 / -1; text-align: center; color: #666;';
                    message.textContent = 'Ongi listaverk funnin.';
                    portfolioGrid.appendChild(message);
                    return;
                }

                let filteredArtworks;
                if (filter === 'all') {
                    filteredArtworks = artworks;
                } else if (filter === 'available') {
                    filteredArtworks = artworks.filter(art => art.available);
                } else {
                    filteredArtworks = artworks.filter(art => art.categories.includes(filter));
                }

                if (filteredArtworks.length === 0) {
                    const message = document.createElement('p');
                    message.style.cssText = 'grid-column: 1 / -1; text-align: center; color: #666;';
                    message.textContent = 'Ongi listaverk funnin fyri hetta filtrið.';
                    portfolioGrid.appendChild(message);
                    return;
                }

                // If showing all artworks, organize by category headers in order: 2025, 2024, Eldri listaverk
                if (filter === 'all') {
                    const categories = [
                        { id: 'y2025', label: '2025' },
                        { id: 'y2024', label: '2024' },
                        { id: 'eldri', label: 'Eldri listaverk' }
                    ];

                    categories.forEach(category => {
                        const categoryArtworks = filteredArtworks.filter(art => 
                            art.categories.includes(category.id)
                        );

                        if (categoryArtworks.length > 0) {
                            // Add category header
                            const header = document.createElement('h2');
                            header.className = 'category-title';
                            header.textContent = category.label;
                            portfolioGrid.appendChild(header);

                            // Add artworks for this category
                            categoryArtworks.forEach(art => {
                                const item = createArtworkElement(art);
                                portfolioGrid.appendChild(item);
                            });
                        }
                    });
                } else {
                    // For other filters, just show the artworks without headers
                    filteredArtworks.forEach(art => {
                        const item = createArtworkElement(art);
                        portfolioGrid.appendChild(item);
                    });
                }

                // Re-initialize Magnific Popup
                $('.portfolio-grid').magnificPopup({
                    delegate: 'a[data-gallery="portfolio-gallery"]',
                    type: 'image',
                    gallery: { enabled: true }
                });
            }

            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    const filter = this.getAttribute('data-filter');
                    renderArtworks(filter);
                    
                    // Sync mobile dropdown
                    const mobileSelect = document.getElementById('mobile-filter');
                    if (mobileSelect) {
                        mobileSelect.value = filter;
                    }
                });
            });

            // Mobile dropdown filter
            const mobileFilter = document.getElementById('mobile-filter');
            if (mobileFilter) {
                mobileFilter.addEventListener('change', function() {
                    const filter = this.value;
                    renderArtworks(filter);
                    
                    // Sync desktop buttons
                    filterButtons.forEach(btn => {
                        if (btn.getAttribute('data-filter') === filter) {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });
                });
            }

            // Initial render
            renderArtworks('all');
        });
    </script>

    <!-- Scripts - Load in correct order -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
    <script src="assets/js/navigation.js" defer></script>

    <script>
        // Mobile menu toggle
        const hamburger = document.getElementById('hamburger');
        const navLinks = document.getElementById('navLinks');
        
        if (hamburger) {
            hamburger.addEventListener('click', () => {
                navLinks.classList.toggle('active');
            });
        }

        // Close mobile menu when clicking a link
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', () => {
                navLinks.classList.remove('active');
            });
        });
    </script>
    
    <!-- Footer Script - Load last -->
    <script src="assets/js/footer.js" defer></script>
    
    <!-- Analytics - Privacy-focused, cookie-free -->
    <script src="assets/js/analytics.js" defer></script>
</body>
</html>
